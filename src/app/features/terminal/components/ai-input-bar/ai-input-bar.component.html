<div class="ai-input-bar">
  <!-- Command Preview Card (floating above input) -->
  <app-command-preview-card
    [command]="previewCommand()"
    [explanation]="previewExplanation()"
    [isDangerous]="previewIsDangerous()"
    (insert)="onPreviewInsert($event)"
    (execute)="onPreviewExecute($event)"
    (dismiss)="dismissPreview()"
  />

  <!-- Error Panel (for configuration errors only) -->
  @if (error(); as err) {
    <div class="error-panel">
      <lucide-icon [img]="AlertCircle" class="w-4 h-4 text-red-400"></lucide-icon>
      <span class="flex-1 text-sm">{{ err }}</span>
      <button
        class="p-1 rounded hover:bg-zinc-800 text-zinc-500 hover:text-zinc-300 transition-colors"
        (click)="dismissError()"
      >
        <lucide-icon [img]="X" class="w-4 h-4"></lucide-icon>
      </button>
    </div>
  }

  <!-- Input Bar -->
  <div class="input-container">
    <!-- Mode Indicator -->
    <div class="mode-indicator" [class.ai-mode]="isAiMode()">
      @if (isAiMode()) {
        <lucide-icon [img]="Sparkles" class="w-4 h-4"></lucide-icon>
      } @else {
        <lucide-icon [img]="Terminal" class="w-4 h-4"></lucide-icon>
      }
    </div>

    <!-- Input Field -->
    <input
      type="text"
      class="command-input"
      [class.ai-mode]="isAiMode()"
      [value]="inputValue()"
      (input)="onInputChange($any($event.target).value)"
      (keydown.enter)="onSubmit()"
      [placeholder]="isAiMode() ? 'Ask AI for help...' : 'Type command or # for AI'"
      [disabled]="isLoading()"
    />

    <!-- Submit Button -->
    <button
      (click)="onSubmit()"
      [disabled]="isLoading() || !inputValue().trim()"
      class="submit-button"
      [class.ai-mode]="isAiMode()"
    >
      @if (isLoading()) {
        <lucide-icon [img]="Loader2" class="w-4 h-4 animate-spin"></lucide-icon>
      } @else if (isAiMode()) {
        <lucide-icon [img]="Sparkles" class="w-4 h-4"></lucide-icon>
        <span>Ask</span>
      } @else {
        <lucide-icon [img]="CornerDownLeft" class="w-4 h-4"></lucide-icon>
        <span>Run</span>
      }
    </button>

    <!-- AI Status -->
    <div class="ai-status">
      @if (!isConfigured()) {
        <a
          routerLink="/settings"
          class="flex items-center gap-1 text-xs text-amber-400 hover:text-amber-300 transition-colors"
          title="Configure AI settings"
        >
          <lucide-icon [img]="Settings" class="w-3 h-3"></lucide-icon>
          <span>Setup AI</span>
        </a>
      } @else {
        <span class="status-dot online"></span>
        <span class="status-text">AI</span>
      }
    </div>
  </div>
</div>
